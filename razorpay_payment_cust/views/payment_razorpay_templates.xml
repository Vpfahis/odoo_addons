<odoo>
    <template id="razorpay_payment_form" name="Razorpay Payment Form">
        <t t-call="payment.payment_form">
            <t t-set="razorpay_order_id" t-value="tx.rendering_values.get('razorpay_order_id')"/>
            <t t-set="razorpay_key_id" t-value="tx.rendering_values.get('razorpay_key_id')"/>
            <t t-set="amount" t-value="int(tx.amount * 100)"/>

            <div class="text-center">
                <button id="rzp-button1" type="button" class="btn btn-primary">Pay with Razorpay</button>
            </div>

            <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    setTimeout(function () {
                        var payBtn = document.getElementById("rzp-button1");
                        if (!payBtn) {
                            console.error("Razorpay button not found in DOM.");
                            return;
                        }

                        var options = {
                            "key": "<t t-esc='razorpay_key_id'/>",
                            "amount": "<t t-esc='amount'/>",
                            "currency": "INR",
                            "name": "Odoo Razorpay Checkout",
                            "description": "Order Payment",
                            "order_id": "<t t-esc='razorpay_order_id'/>",
                            "handler": function (response) {
                                var form = document.createElement("form");
                                form.method = "POST";
                                form.action = "/payment/razorpay/verify";
                                for (var key in response) {
                                    var input = document.createElement("input");
                                    input.type = "hidden";
                                    input.name = key;
                                    input.value = response[key];
                                    form.appendChild(input);
                                }
                                document.body.appendChild(form);
                                form.submit();
                            }
                        };

                        var rzp = new Razorpay(options);
                        payBtn.addEventListener("click", function (e) {
                            rzp.open();
                            e.preventDefault();
                        });
                    }, 100); // Delay just to ensure DOM is fully painted
                });
            </script>
        </t>
    </template>
</odoo>
